<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/leaforheart.github.io/image/myico.jpg">

    <title>leaforbook - Shiro数据</title>

    <!-- Bootstrap core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/leaforheart.github.io/css/starter.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="/leaforheart.github.io/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="/leaforheart.github.io/js/ie-emulation-modes-warning.js"></script>

    <script src="/leaforheart.github.io/js/jquery-3.1.0.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Bootstrap core JavaScript================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/leaforheart.github.io/js/ie10-viewport-bug-workaround.js"></script>

    <script>
        $(document).ready(function () {
            $('#home-bar').bind('click', function () {
                $('#home-bar').addClass('active');
                $('#about-bar').removeClass('active');
                $('#contact-bar').removeClass('active');
            })
            $('#about-bar').bind('click', function () {
                $('#home-bar').removeClass('active');
                $('#about-bar').addClass('active');
                $('#contact-bar').removeClass('active');
            })
            $('#contact-bar').bind('click', function () {
                $('#home-bar').removeClass('active');
                $('#about-bar').removeClass('active');
                $('#contact-bar').addClass('active');
            })
        })
    </script>
</head>

<body>
<img src="/leaforheart.github.io/image/logo.jpg" width="0" height="0">
<nav class="navbar navbar-default navbar-fixed-top" id="header-bar">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/leaforheart.github.io/index.html"><img
                    src="/leaforheart.github.io/image/logo.png" width="50%"></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li id="home-bar"><a href="/leaforheart.github.io/index.html" class="navbar-link">Home</a></li>
                <li id="about-bar"><a href="/leaforheart.github.io/about.html" class="navbar-link">About</a></li>
                <li id="contact-bar"><a href="/leaforheart.github.io/contact.html" class="navbar-link">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<ol class="breadcrumb">
    <li><a href="/leaforheart.github.io/index.html">Home</a></li>
    <li><a href="/leaforheart.github.io/blog/index.html">技术博客</a></li>
    <li><a href="/leaforheart.github.io/blog/shiro/shiro.html">Shiro</a></li>
    <li class="active">翻译：9 Apache Shiro数据</li>
</ol>

<h1>9 Apache Shiro数据</h1>
<div class="article-subtitle"><p>译者：<a href="/leaforheart.github.io/about.html">肖一林</a> 2016年11月01日</p></div>

<div class="article-text">
    <span><div>Realm是一个可以访问应用特定的安全数据（如用户，角色和权限）的组件。Realm把应用的特定安全数据翻译成一种Shiro可以理解的格式，所以不管有多少安全数据源存在，也不管你的应用的安全数据有多特别，Shiro都可以提供一个简单易懂的 <a
            href="http://shiro.apache.org/subject.html"
            style="outline: 0px; color: rgb(64, 104, 195); text-decoration: underline; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"
            title="Subject">Subject</a> API。</div><div><br/></div><div>Realm和数据源通常是一对一的关系，数据源可能是关系型数据库，LDAP目录，文件系统，或者其他类似的资源。因此，Realm实现是用各种不同的数据源的API来获取授权数据（角色、权限等等）的，比如JDBC，文件IO，Hibernate或JPA，或者任何其他的数据API。</div><div><br/></div><table
            style="-evernote-table:true;border-collapse:collapse;table-layout:fixed;margin-left:0px;width:100%;"><tbody><tr><td
            style="border-style:solid;border-width:1px;border-color:rgb(211,211,211);padding:10px;margin:0px;width:99.92266047950503%;"><i>Realm实际上是一个安全数据源的DAO</i></td></tr></tbody></table><div><br/></div><div>因为这些数据源大部分都在存储授权数据（像角色或权限）的同时存储认证数据（像密码一样的凭证），每一个Realm都能同时执行认证和授权操作。</div><div><br/></div><div
            style="color: rgb(50, 84, 160); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold; font-size: 20px;"><div>Realm 配置</div></div><div><br/></div><div>如果用Shiro的INI配置，像其他对象一样，你可以在[main]部分定义和引用Realm，但是Realm配置在securityManager上面有两种方式：显式的和隐式的。</div><div><br/></div><div
            style="color: rgb(0, 0, 0); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold; font-size: 15px;"><div>显式分配</div></div><div><br/></div><div>基于到目前为止我们对INI配置的认识，这是一个很明显的配置方式。在定义了一个或多个Realm后，你把它们当做一个集合属性设置给securityManager对象。</div><div><br/></div><div>例如：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>fooRealm = com.company.foo.Realm<br/>
barRealm = com.company.another.Realm<br/>
bazRealm = com.company.baz.Realm<br/><br/></div><div>securityManager.realms = $fooRealm, $barRealm, $bazRealm</div></div><div><br/></div><div>显式分配是确定的——你可以精确地控制它们在认证和授权的时候的执行顺序，在认证章节的认证步骤部分（ <a
            href="http://shiro.apache.org/authentication.html#Authentication-sequence"
            style="outline: 0px; color: rgb(64, 104, 195); text-decoration: underline; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Authentication Sequence</a>）对Realm顺序的影响做了很详细的描述。</div><div><br/></div><div
            style="color: rgb(0, 0, 0); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold; font-size: 15px;">隐式分配</div><div><br/></div><table
            style="-evernote-table:true;border-collapse:collapse;table-layout:fixed;margin-left:0px;width:100%;"><tbody><tr><td
            style="border-style:solid;border-width:1px;border-color:rgb(211,211,211);padding:10px;margin:0px;width:99.92266047950503%;"><div><i><span
            style="font-size: 16px;"><b>不要当做首选</b></span></i></div><div><i><br/></i></div><div><i>如果你改变Realm定义的顺序去执行，隐式分配可能会发生难以预料的行为。建议你避免这个方法，用显式分配，显式分配有明确的行为。在未来的某个Shiro发布版本可能会取消隐式分配。</i></div></td></tr></tbody></table><div><br/></div><div>如果因为某些理由，你不想显式配置securityManager.realms属性，你可以允许Shiro自行发现所有配置了的Realm，然后直接分配给securityManager。</div><div><br/></div><div>用这种方法，Realm会按照它们被定义的顺序逐一分配给securityManager实例。</div><div><br/></div><div>也就是说，像下面的shiro.ini例子：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>blahRealm = com.company.blah.Realm<br/>
fooRealm = com.company.foo.Realm<br/>
barRealm = com.company.another.Realm<br/><br/></div><div># no securityManager.realms assignment here</div></div><div><br/></div><div>和后面加上这行配置效果是一样的：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>securityManager.realms = $blahRealm, $fooRealm, $barRealm</div></div><div><br/></div><div>然而，当使用隐式分配的时候必须要意识到，仅仅是Realm被定义的顺序，就会直接影响到当用户进行认证和授权尝试时，这些Realm被调用的情况。如果你改变了定义顺序，你就改变了主认证人的认证步骤（ <a
            href="http://shiro.apache.org/authentication.html#Authentication-sequence"
            style="outline: 0px; color: rgb(64, 104, 195); text-decoration: underline; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Authentication Sequence</a>）功能。</div><div><br/></div><div>基于这个理由，并且保证精确的行为，我们推荐用显式分配，不要用隐式分配。</div><div
            style="font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 22px; margin-bottom: 11px; font-size: 34px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#realm-authentication" name="realm-authentication"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Realm Authentication</a></div></div></div><div><br/></div><div>你一旦理解了Shiro的主认证流程（ <a
            href="http://shiro.apache.org/authentication.html#Authentication-sequence"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Authentication workflow</a>），那么了解在一次认证尝试期间Authenticator和Realm到底是怎么交互的就变得很重要了。</div><div
            style="box-sizing: border-box; font-weight: 500; margin-top: 22px; margin-bottom: 11px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><code
            style="box-sizing: border-box; padding: 2px 4px; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-size: 28px;"><font
            color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif">支持</font></code><code
            style="color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 25.2px; box-sizing: border-box; padding: 2px 4px; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">AuthenticationTokens</code></div></div><div>正如认证顺序（ <a
            href="http://shiro.apache.org/authentication.html#Authentication-sequence"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">authentication sequence</a>）一节提到的，在Realm被请求执行一个认证尝试之前，Realm的 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/Realm.html#supports-org.apache.shiro.authc.AuthenticationToken-"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;">supports</code></a>方法会先被调用。如果这个方法返回true，才会继续调用Realm的<span
            style="color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(249, 242, 244); display: inline !important; float: none;">getAuthenticationInfo(token)</span> 方法。</div><div><br/></div><div>通常Realm会检查提交的这个token的类型（接口或类），以判断能否处理它。例如，一个专门处理生物特征识别的Realm可能就完全不会理解 <code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">UsernamePasswordTokens</code><span
            style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span> ，这时这个Realm的supports方法就会返回false。</div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 22px; margin-bottom: 11px; font-size: 28px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>处理支持的 <code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 25.2px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;">AuthenticationTokens</code></div></div><div>如果Realm支持提交过来的 <span
            style="color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(249, 242, 244); display: inline !important; float: none;">AuthenticationToken</span> ， <code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Authenticator</code><span
            style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span> 将调用Realm的 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/Realm.html#getAuthenticationInfo-org.apache.shiro.authc.AuthenticationToken-"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(50, 84, 160); text-decoration: none; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">getAuthenticationInfo(token)</a> 方法。这有效地代表了通过Realm支持的数据源进行的一次认证尝试。这个方法按顺序执行如下步骤：</div><ol><li>检查token的主体身份（账户身份信息）</li><li>基于主体信息，在数据源中查找相应的账户数据</li><li>确保token提供的凭证（ <code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">credentials</code><span
            style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span>）能匹配上数据存储里的值</li><li>如果凭证匹配上了，就返回一个 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/AuthenticationInfo.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthenticationInfo</a>实例，这个实例封装了账户数据，并以一种Shiro可以理解的格式封装</li><li>如果凭证匹配不上，抛出一个 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/AuthenticationException.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthenticationException</a>异常</li></ol><div><br/></div><div>这是所有Realm的getAuthenticationInfo方法实现的最高级别工作流程。Realm在这个方法中可以自由地做任何事情，在审计日志中把这次认证尝试记录下来，更新数据记录，或对于这次认证尝试的数据存储任何有意义的操作。</div><div><br/></div><div>唯一的约束就是，如果凭证匹配提供的主体，数据源必须返回一个非空 <code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthenticationInfo</code><span
            style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span> 实例，这个实例包含了主体的账户信息。</div><div><br/></div><table
            style="-evernote-table:true;border-collapse:collapse;table-layout:fixed;margin-left:0px;width:100%;"><tr><td
            style="border-style:solid;border-width:1px;border-color:rgb(211,211,211);padding:10px;margin:0px;width:99.92266047950503%;"><div><span
            style="font-size: 16px;"><b><i>节省时间</i></b></span></div><div><br/></div><div>直接实现Realm接口可能会非常耗时并且容易出错。大部分人选择继承抽象类<span
            style="color: rgb(49, 112, 143); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(217, 237, 247); float: none; display: inline !important;"> </span><a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/AuthorizingRealm.html"
            style="box-sizing: border-box; background-color: rgb(217, 237, 247); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthorizingRealm</a><span
            style="color: rgb(49, 112, 143); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(217, 237, 247); float: none; display: inline !important;"> </span> ，而不是重头开始。这个类实现了通用的认证和授权工作流程，可以节省你的时间了精力。 </div></td></tr></table><div><br/></div><div
            style="box-sizing: border-box; font-weight: 500; margin-top: 22px; margin-bottom: 11px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span
            style="color: rgb(51, 51, 51);"><span style="font-size: 28px;"><span
            style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">凭证匹配（</span></span></span><a
            href="http://shiro.apache.org/realm.html#credentials-matching" name="credentials-matching"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Credentials Matching</a> <span
            style="color: rgb(51, 51, 51);"><span style="font-size: 28px;"><span
            style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">）</span></span></span></div></div><div>在上面Realm的认证流程中，Realm必须校验主体提交过来的凭证（比如，密码），它必须和数据存储中的凭证相匹配。如果匹配上了，认证就认为是成功的，也就是说这时系统已经验明了终端用户的身份。</div><div><br/></div><table
            style="-evernote-table:true;border-collapse:collapse;table-layout:fixed;margin-left:0px;width:100%;"><tr><td
            style="border-style:solid;border-width:1px;border-color:rgb(211,211,211);padding:10px;margin:0px;width:99.92266047950503%;"><div><i><span
            style="font-size: 16px;"><b>Realm凭证匹配</b></span></i></div><div><br/></div><div>把被提交的凭证和Realm支持的数据存储里的凭证匹配起来，是每一个Realm的责任，而不是Authenticator的责任。每个Realm都最清楚自己的凭证格式和存储方式，只有知道这些才知道具体怎么匹配，而Authenticator是一个通用的工作流程组件。</div></td></tr></table><div><br/></div><div>凭证匹配的过程在所有应用中几乎一样，通常只有数据比对那个环节不同。为了保证该过程可插拔和可定制， <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/AuthenticatingRealm.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthenticatingRealm</a> 和它的子类支持作为一个具体的凭证匹配器（ <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/CredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(50, 84, 160); text-decoration: none; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">CredentialsMatcher</a>），来执行凭证比对。</div><div><br/></div><div>在找出账户数据后，账户数据和提交的<code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">AuthenticationToken</code>一起提交给<code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">CredentialsMatcher</code>，看二者是否匹配。 </div><div><br/></div><div>Shiro有一些<code
            style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">CredentialsMatcher</code>实现供你现成使用，比如 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/SimpleCredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">SimpleCredentialsMatcher</a>和 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/HashedCredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">HashedCredentialsMatcher</a> ，但是如果你想配置一个定制化的实现，用来定制化匹配逻辑，你可以直接用如下代码：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Realm myRealm = new com.company.shiro.realm.MyRealm();</div><div>CredentialsMatcher customMatcher = new com.company.shiro.realm.CustomCredentialsMatcher();</div><div>myRealm.setCredentialsMatcher(customMatcher);</div></div><div><br/></div><div>或者使用Shiro的INI配置：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>[main]</div><div>...</div><div>customMatcher = com.company.shiro.realm.CustomCredentialsMatcher</div><div>myRealm = com.company.shiro.realm.MyRealm</div><div>myRealm.credentialsMatcher = $customMatcher</div><div>...</div></div><div><br/></div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 11px; margin-bottom: 11px; font-size: 20px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#simple-equality-check" name="simple-equality-check"
            style="box-sizing: border-box; background-color: transparent; color: rgb(50, 84, 160); text-decoration: none;">Simple Equality Check</a></div></div><div>Shiro中所有现成的Realm实现都默认使用 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/SimpleCredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(50, 84, 160); text-decoration: none; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">SimpleCredentialsMatcher</a>。SimpleCredentialsMatcher直接让存储的账户凭证和AuthenticationToken提交的凭证二者做个等式检查。</div><div><br/></div><div>例如，如果提交了一个 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/UsernamePasswordToken.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">UsernamePasswordToken</a> ，SimpleCredentialsMatcher就会校验提交过来的密码是否和数据库中的密码相等。</div><div><br/></div><div>SimpleCredentialsMatcher不仅可以用来比较字符串。它可以用来比较大多数通用的字节源，比如字符串，字符数组，字节数组，文件和输入流。想了解更多请查看它的JavaDoc。</div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 11px; margin-bottom: 11px; font-size: 20px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#hashing-credentials" name="hashing-credentials"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Hashing Credentials</a></div></div><div>比起直接存储凭证的原始格式并进行直接比较，在把终端用户的凭证（比如密码）存储起来之前先进行单向哈希运算，会安全的多。</div><div><br/></div><div>这保证了终端用户的凭证不会直接把原始格式存储起来，所以没有人知道原始值。这是一种比纯文本或原始比较要安全的多的机制，所有安全敏感的应用都应该支持对非哈希存储使用这种方法。</div><div><br/></div><div>为了支持这些更加推荐的加密哈希策略，Shiro支持给Realm配置 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/HashedCredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">HashedCredentialsMatcher</a>实现，替换前面提到的SimpleCredentialsMatcher。</div><div><br/></div><div>哈希化凭证，加盐的好处和多次迭代哈希，这些主题都超出了Realm文档所描述的范围。但是在 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/credential/HashedCredentialsMatcher.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">HashedCredentialsMatcher JavaDoc</a>中对这些主题都有详细的描述。</div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 11px; margin-bottom: 11px; font-size: 16px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#hashing-and-corresponding-matchers"
            name="hashing-and-corresponding-matchers"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Hashing and Corresponding Matchers</a></div></div><div>但是你该如何配置一个嵌入了Shiro的应用，使之能简单地使用哈希凭证？</div><div><br/></div><div>Shiro提供了很多HashedCredentialsMatcher子类实现。你必须给你Realm配置具体的实现，用来匹配你给你的用户凭证使用的哈希算法。</div><div><br/></div><div>例如，假使你的应用使用“用户名/密码 对”进行认证。由于上面描述了那么多关于哈希凭证的好处，比方说当创建一个用户的时候，你想用 <a
            href="https://en.wikipedia.org/wiki/SHA_hash_functions"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">SHA-256</a>算法来单向哈希用户的密码。你要把用户提交过来的纯文本密码先哈希，然后保存那个哈希值。</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>import org.apache.shiro.crypto.hash.Sha256Hash;</div><div>import org.apache.shiro.crypto.RandomNumberGenerator;</div><div>import org.apache.shiro.crypto.SecureRandomNumberGenerator;</div><div>...</div><div>//We'll use a Random Number Generator to generate salts. This</div><div>//is much more secure than using a username as a salt or not</div><div>//having a salt at all. Shiro makes this easy.</div><div>//</div><div>//Note that a normal app would reference an attribute rather</div><div>//than create a new RNG every time:</div><div>RandomNumberGenerator rng = new SecureRandomNumberGenerator();</div><div>Object salt = rng.nextBytes();</div><div><br/></div><div>//Now hash the plain-text password with the random salt and multiple</div><div>//iterations and then Base64-encode the value (requires less space than Hex):</div><div>String hashedPasswordBase64 = new Sha256Hash(plainTextPassword, salt, 1024).toBase64();</div><div><br/></div><div>User user = new User(username, hashedPasswordBase64);</div><div>//save the salt with the new account. The HashedCredentialsMatcher</div><div>//will need it later when handling login attempts:</div><div>user.setPasswordSalt(salt);</div><div>userDAO.create(user);</div></div><div><br/></div><div>由于你用的是SHA-256算法，你要告诉Shiro使用合适的HashedCredentialsMatcher来匹配你的哈希选择。在这个例子中，我们创建了一个随机的盐，并且执行了1024次哈希迭代，已达到强安全性（想知道为什么请参看HashedCredentialsMatcher JavaDoc）。下面是Shiro INI配置使上面的代码能工作：</div><div><br/></div><div
            style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>[main]</div><div>...</div><div>credentialsMatcher = org.apache.shiro.authc.credential.Sha256CredentialsMatcher</div><div># base64 encoding, not hex in this example:</div><div>credentialsMatcher.storedCredentialsHexEncoded = false</div><div>credentialsMatcher.hashIterations = 1024</div><div># This next property is only needed in Shiro 1.0\. Remove it in 1.1 and later:</div><div>credentialsMatcher.hashSalted = true</div><div><br/></div><div>...</div><div>myRealm = com.company.....</div><div>myRealm.credentialsMatcher = $credentialsMatcher</div><div>...</div></div><div><br/></div><div><a
            href="http://shiro.apache.org/realm.html#saltedauthenticationinfo" name="saltedauthenticationinfo"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 500; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">SaltedAuthenticationInfo</a></div><div><br/></div><div>最后要保证的是，你的Realm实现必须要返回一个 <a
            href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/SaltedAuthenticationInfo.html"
            style="box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">SaltedAuthenticationInfo</a>实例，而不是一个普通的AuthenticationInfo实例。SaltedAuthenticationInfo实例可以让你获取当你创建这个账户时使用的盐（比如上面调用的user.setPasswordSalt(salt)），HashedCredentialsMatcher要用到这个盐。</div><div><br/></div><div>HashedCredentialsMatcher需要这个盐，因为有了它才能对提交的AuthenticationToken执行相同的哈希技术，来判断这个token是否匹配数据存储中的哈希值。所以如果你对用户密码加密使用了盐（强烈建议你这么做），就必须保证你的Realm实现可以返回SaltedAuthenticationInfo实例。</div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 22px; margin-bottom: 11px; font-size: 28px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#disabling-authentication" name="disabling-authentication"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Disabling Authentication</a></div></div><div>因为某种原因，你可能不想让某个Realm执行认证（你可能只想让它执行授权），你可以禁用该Realm对认证的支持，通过让Realm的supports方法返回一个false。这样的话，当认证尝试的时候，你的Realm就永远不会被访问了。</div><div><br/></div><div>当然，要保证只要一个配置了的Realm能支持AuthenticationTokens，如果你想认证主体的话。</div><div
            style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 500; color: rgb(51, 51, 51); margin-top: 22px; margin-bottom: 11px; font-size: 34px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><a
            href="http://shiro.apache.org/realm.html#realm-authorization" name="realm-authorization"
            style="box-sizing: border-box; background-color: transparent; color: rgb(32, 53, 102); text-decoration: underline; outline: -webkit-focus-ring-color auto 5px; outline-offset: -2px;">Realm Authorization</a></div></div><div>暂无</div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><a
            href="http://shiro.apache.org/realm.html">原文地址</a></div><div><br/></div><div><br/></div></span>
</div>

<div class="article-next-back">
    <div class="article-back">上一篇：<a href="/leaforheart.github.io/blog/shiro/translate/permissions.html">Shiro权限</a>
    </div>
    <div class="article-next">下一篇：暂无</div>
</div>

<link href="/leaforheart.github.io/css/article.css" rel="stylesheet">

</body>
</html>